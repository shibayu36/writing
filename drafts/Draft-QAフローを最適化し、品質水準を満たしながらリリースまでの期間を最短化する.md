こんにちは、クラスター株式会社でソフトウェアエンジニアをやっているid:shiba_yu36:detailです。

僕は最近クラスター株式会社の開発フローで、QAフローを最適化し、品質水準を満たしながらリリースまでの期間を最短化する取り組みを行いました。今回はその取り組みについて紹介します。

[:contents]

### これまでの課題

#### 課題1: コード変更からリリースまでの期間が長い
クラスター株式会社はメタバースプラットフォームである「cluster」というサービスを提供しています。このサービスでの障害を最小に抑えるため、リリース時にはQAチームによる非常に手厚いQAフローを運用していました。

以前のコード変更〜QA〜リリースまでの全体像を図にしたものがこちらです。

TODO: https://miro.com/app/board/uXjVNXW_cl8=/?moveToWidget=3458764646568977296&cot=14 の図を追加

簡単な流れを説明すると

- ある機能やバグ修正を次のリリースに含めるときは、QA週より前の木曜日までにコード変更を完了し、開発チーム内で動作確認を行なっておく
- 金曜にrelease用のgit branchを作成する
- QA週にQAチームが1週間かけてテストを行う。主に3つのQAを行う。
    - 新機能QA: 新規開発した機能について詳細にテストを行う。月〜水曜に行う
    - regression QA: サービスの主要機能が全て動作するかを包括的にテストする。水〜木曜に行う
    - バグ修正確認: 今回のリリースに含まれるバグ修正が正しく動作するかテストする。水曜 or 木曜に行う
- 木曜にQA承認されたら、開発チームがiOS/Androidアプリの審査を提出する
- 審査が通過したら、QAの翌週の月曜にリリースを行う

このQAフローによって、サービスの障害は非常に少ない状態に保たれていました。しかし一方で、コード変更からリリースまで最短でも12日かかってしまうという課題がありました。

コード変更からリリースまでの期間が長いと、次のような問題が起きます。

- あるリリースでバグが発覚しても、直してリリースするまで2週間かかってしまう
- 作ったものを早くユーザーに届けられない。結果としてユーザーの反応から素早く学びサービス改善に活かすことがしづらい。

そこで障害数をコントロールした上で、リリースまでの期間を最短化するため、QAフローを最適化したいと考えました。

#### 課題2: リリースQAとコンテンツQA両方が必要でQAチームの負荷が高い
前述したQAはリリースQAについてでした。実はQAチームはコンテンツQAというもう一つのQAを行なっており、このためQAチームの負荷が高いという課題もありました。

clusterでは、一般ユーザー向けにサービス提供している以外に、3D空間を活用した施策を実施した企業向けに空間制作を受注するという事業も行なっています。この事業のために、弊社には3D空間制作チームがあります。

この3D空間を制作し、企業さまへ納品するとき、3D空間自体が仕様どおりに動いているかを品質保証する必要があります。そのため、QAチームが納品ごとに3D空間をテストしており、これをコンテンツQAと呼んでいます。

QAチームは開発チームによるサービスリリースのためのリリースQAと、3DCGチームによる空間制作のためのコンテンツQAの両方を行なっていて、チームの負荷が高い状況でした。

### 改善全体方針と改善後のフロー
これら2つの課題を解決するため、全体的な方針は次のようにしました。

- サービスとしてのQAはQAメンバーと相談し最適なテストケースを決めた上で開発チームが行い、障害数をコントロールした上でリリースまでの期間を短縮する
- QAチームにはコンテンツQAに集中してもらい、企業向けの事業の品質水準を担保した上で、負荷を軽減する

改善後の開発チームのサービスリリースフローは次のようになりました。

TODO: https://miro.com/app/board/uXjVNXW_cl8=/?moveToWidget=3458764646569550590&cot=14 の図を追加

- 水曜までに機能開発者は自分以外の数名集めて動作確認を完了しておく
- 水曜夕方にrelease用のgit branchを作成する
- 木曜に開発チーム全員が集まり、新機能QA、regression QA、バグ修正確認を一気に終わらせる
    - 2時間程度で完了させられるように、QAのテストケースは調整した
- 木曜夕方にQA含めてリリース承認を行い、iOS/Androidアプリの審査を提出する
- 審査が通過したら、翌週の月曜にリリースを行う

このフローによって、コード変更からリリースまでの期間を最短で5日程度に短縮できました。またこのフローを実施し始めてから半年経ちましたが、顕著な障害増加は起こっておらず、品質もコントロールできています。

### サービスリリースの改善後のQAフローに到達するために何を行なったか
ここまでで、これまでのサービスリリースのQAフローにどのような課題があり、改善して最終的にどのようなQAフローになったかを説明しました。

ではこのサービスリリースの改善後のQAフローに到達するために、どのような手順で改善を進めたかを紹介します。大まかには次のような手順で実施していきました。

1. 事業の特性を理解して達成したい品質基準を決める
2. 開発フローの制約条件を理解する
3. 達成したい品質条件や制約条件を満たすように、QAフローおよびその周辺の開発フローを設計する
4. QAメンバーと一緒に、QAのregressionテストのテストケースや、テストすべき内容を決め直す
5. 決定した理想系に向けて移行計画を作る
6. 3ヶ月かけて、理想系まで移行する

ではそれぞれの手順について説明します。

#### 1. 事業の特性を理解して達成したい品質基準を決める

